<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
    integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="css/login.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous" />
  <link rel="stylesheet" href="css/style.css">
  <script src="sweetalert2.all.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <title>Turi. | Cadastro</title>
</head>

<body>
  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top ">
    <div class="container d-flex align-items-center justify-content-between">

      <!-- <h1 class="logo"><a href="index.html">Resi.</a></h1> -->
      <!-- Uncomment below if you prefer to use an image logo -->
      <a href="index.html" class="logo"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link scrollto active" href="index.html">Início</a></li>
          <li><a class="nav-link scrollto" href="#about">Sobre nós</a></li>
          <li><a class="nav-link scrollto" href="#services">Serviços</a></li>
          <li><a class="nav-link scrollto" href="#team">Time</a></li>
          <!-- <li class="dropdown"><a href="#"><span>Drop Down</span> <i class="bi bi-chevron-down"></i></a>
            <ul>
              <li><a href="#">Drop Down 1</a></li>
              <li class="dropdown"><a href="#"><span>Deep Drop Down</span> <i class="bi bi-chevron-right"></i></a>
                <ul>
                  <li><a href="#">Deep Drop Down 1</a></li>
                  <li><a href="#">Deep Drop Down 2</a></li>
                  <li><a href="#">Deep Drop Down 3</a></li>
                  <li><a href="#">Deep Drop Down 4</a></li>
                  <li><a href="#">Deep Drop Down 5</a></li>
                </ul>
              </li>
              <li><a href="#">Drop Down 2</a></li>
              <li><a href="#">Drop Down 3</a></li>
              <li><a href="#">Drop Down 4</a></li>
            </ul>
          </li> -->
          <li><a class="nav-link scrollto" href="#contact">Contato</a></li>
          <li><a class="getstarted scrollto" href="./login.html">Cadastre-se</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->

  <main>
    <div class="container-log">
      <div class="forms-container">
        <div class="signin-signup">

          <form action="#" class="sign-in-form">
            <h2 class="title">Entrar</h2>

            <div class="input-field">
              <i class="fas fa-user"></i>
              <input type="text" placeholder="CNPJ/Email" id="in_usuarioLogin"/>
            </div>

            <div class="input-field">
              <i class="fas fa-lock"></i>
              <input type="password" placeholder="Senha" required minlength="8" id="in_senhaLogin"/>
            </div>

            <input type="button" class="btn-log" value="Entrar" onclick="Entrar()" />
          </form>

          <form action="#" class="sign-up-form">
            <h2 class="title">Cadastre-se</h2>

            <!-- Cadastro de Usuário da TURI -->
            <!--Input que some e volta, baseado no valor do switch-->
            <div class="input-field" id="nomeUsuario">
              <i class="fas fa-user"></i>
              <input type="text" placeholder="Nome de Usuário" id="in_nomeTuri" />
            </div>

            <div class="input-field" id="emailTuri">
              <i class="fas fa-envelope"></i>
              <input type="email" placeholder="Email" id="in_emailTuri" />
            </div>

            <div class="input-field" id="senhaTuri">
              <i class="fas fa-lock"></i>
              <input type="password" placeholder="Senha" required minlength="8" id="in_senhaTuri" />
            </div>

            <div class="input-field" id="codEmpresa">
              <i class="fa-solid fa-key"></i>
              <input type="text" placeholder="Código da Turi" id="in_codTuri">
            </div>

            <!-- daqui até a linha 145, aparece somente quando o switch está ligado para cadastro empresarial -->
            <div class="input-field" id="nomeEmpresa" style="display:none ;">
              <i class="fa-solid fa-user-group"></i>
              <input type="text" placeholder="Nome da Empresa" id="in_nomeEmpresa"/>
            </div>

            <div class="input-field" id="codCnpj" style="display:none ;">
              <i class="fa-solid fa-building-user"></i>
              <input type="text" placeholder="CPNJ" id="in_cnpjEmpresa"/>
            </div>

            <div class="input-field" id="codRua" style="display:none ;">
              <i class="fa-solid fa-street-view"></i>
              <input type="text" placeholder="Rua" id="in_ruaEmpresa"/>
            </div>

            <div class="input-field" id="codBairro" style="display:none ;">
              <i class="fa-solid fa-map-location-dot"></i>
              <input type="text" placeholder="Bairro" id="in_bairroEmpresa"/>
            </div>

            <div class="input-field" id="codNumero" style="display:none ;">
              <i class="fa-solid fa-house-user"></i>
              <input type="number" placeholder="Número" id="in_numeroEmpresa"/>
            </div>

            <div class="input-field" id="codCidade" style="display:none ;">
              <i class="fa-solid fa-city"></i>
              <input type="text" placeholder="Cidade" id="in_cidadeEmpresa"/>
            </div>

            <div class="input-field" id="senhaCliente" style="display:none ;">
              <i class="fas fa-lock"></i>
              <input type="password" placeholder="Senha" required minlength="8" id="in_senhaEmpresa"/>
            </div>

            <!--Botão de swicth-->
            <div class="container-switch">
              <label class="switch">
                <input type="checkbox" id="ipt_switch" onclick="sumirInput()">
                <span class="slider round"></span>
              </label>
              <p style="color:black ;">Cadastro empresarial</p>
            </div>

            <input type="button" class="btn-log" value="Cadastrar" onclick="Cadastrar()" />
          </form>
        </div>
      </div>

      <div class="panels-container">
        <div class="panel left-panel">
          <div class="content">
            <h3>Novo aqui?</h3>
            <p>
              Faça a sua conta empresarial e acompanhe as suas máquinas. <br> Confira!
            </p>
            <button class="btn-log transparent" id="sign-up-btn">
              Cadastre-se
            </button>
          </div>
        </div>
        <div class="panel right-panel">
          <div class="content">
            <h3>Já nos conhece?</h3>
            <p>
              Entre em sua conta.
            </p>
            <button class="btn-log transparent" id="sign-in-btn">
              Entrar
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- <footer>
    <section class="footer">
      <div class="ft-social">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-google"></i></i></a>
        <a href="#"><i class="fab fa-linkedin-in"></i></a>
      </div>

      <ul class="list">
        <li>
          <a href="#">Início</a>
        </li>
        <li>
          <a href="#">Sobre</a>
        </li>
        <li>
          <a href="#">Projetos</a>
        </li>
        <li>
          <a href="#">Contato</a>
        </li>
      </ul>
      <p class="copyright">
        © 2022 Turing - Todos direitos reservados
      </p>
    </section>
  </footer> -->

  <script src="js/functions.js"></script>
  <script src="js/app.js"></script>
  <script src="https://kit.fontawesome.com/0552a07945.js" crossorigin="anonymous"></script>
  <script src="assets/js/main.js"></script>

</body>

</html>

<script>
  function Cadastrar() {

    if (ipt_switch.checked){
      var nomeVar = in_nomeEmpresa.value;
      var cnpjVar = in_cnpjEmpresa.value;
      var senhaVar = in_senhaEmpresa.value;
      var ruaVar = in_ruaEmpresa.value;
      var bairroVar = in_bairroEmpresa.value;
      var numeroVar = in_numeroEmpresa.value;
      var cidadeVar = in_cidadeEmpresa.value;

      if (nomeVar == "" || cnpjVar == "" || senhaVar == "" || ruaVar == "" || bairroVar == "" || numeroVar == "" || cidadeVar == "") {
        alert("valores vazios")
        return false;
      }

      fetch("/usuarios/cadastrarEmpresa", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          nomeServer: nomeVar,
          cnpjServer: cnpjVar,
          ruaServer: ruaVar,
          bairroServer: bairroVar,
          numeroServer: numeroVar,
          senhaServer: senhaVar,
          cidadeServer: cidadeVar
        })
      }).then(function (resposta) {

        console.log("resposta: ", resposta);

        if (resposta.ok) {
          Swal.fire({
            position: 'center',
            icon: 'success',
            title: 'Seu cadastro foi realizado!',
            showConfirmButton: false,
            timer: 1500}
          )
            setTimeout(() => {
            window.location = "login.html";
          }, "2000")

        } else {
          throw ("Houve um erro ao tentar realizar o cadastro!");
        }
      }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
    } else {
      var nomeVar = in_nomeTuri.value;
      var emailVar = in_emailTuri.value;
      var senhaVar = in_senhaTuri.value;
      var codVar = in_codTuri.value;

      if (nomeVar == "" || emailVar == "" || senhaVar == "" || codVar == "") {
        alert("valores vazios")
        return false;
      }
      if (codVar == 1050) {
        fetch("/usuarios/cadastrarUsuario", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          nomeServer: nomeVar,
          emailServer: emailVar,
          senhaServer: senhaVar,
        })
      }).then(function (resposta) {

        console.log("resposta: ", resposta);

        if (resposta.ok) {
          Swal.fire({
          position: 'center',
          icon: 'success',
          title: 'Seu cadastro foi realizado!',
          showConfirmButton: false,
          timer: 2000}
          )
          
          setTimeout(() => {
            window.location = "login.html";
          }, "3000")

        } else {
          throw ("Houve um erro ao tentar realizar o cadastro!");
        }
      }).catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
    }
  }
    
    return false;
    
    
  }

  function Entrar() {

    var usuarioVar = in_usuarioLogin.value;
    var senhaVar = in_senhaLogin.value;

    if (usuarioVar == "" || senhaVar == "") {
      alert("valores vazios")
      return false;
    }

    console.log("FORM LOGIN: ", usuarioVar);
    console.log("FORM SENHA: ", senhaVar);

    if (usuarioVar.indexOf('@') > -1) {

      fetch("/usuarios/autenticarUsuario", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          usuarioServer: usuarioVar,
          senhaServer: senhaVar
        })
      }).then(function (resposta) {
        console.log("ESTOU NO THEN DO entrar()!")

        if (resposta.ok) {
          console.log(resposta);

          resposta.json().then(json => {
            console.log(json);
            console.log(JSON.stringify(json));

            sessionStorage.IDENTIFICADOR_USUARIO = json.email;
            sessionStorage.NOME_USUARIO = json.nome;
            sessionStorage.ID_USUARIO = json.id;

            setTimeout(function () {
              window.location = "dashboardTec.html";
            }, 1000);

          });

        } else {

          console.log("Houve um erro ao tentar realizar o login!");

          resposta.text().then(texto => {
            console.error(texto);
          });
        }

      }).catch(function (erro) {
        console.log(erro);
      })
    } else {
      fetch("/usuarios/autenticarEmpresa", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          cnpjServer: usuarioVar,
          senhaServer: senhaVar
        })
      }).then(function (resposta) {
        console.log("ESTOU NO THEN DO entrar()!")

        if (resposta.ok) {
          console.log(resposta);

          resposta.json().then(json => {
            console.log(json);
            console.log(JSON.stringify(json));

            sessionStorage.IDENTIFICADOR_USUARIO = json.cnpj;
            sessionStorage.NOME_USUARIO = json.nome;
            sessionStorage.ID_USUARIO = json.id;

            setTimeout(function () {
              window.location = "dashboard.html";
            }, 1000);

          });

        } else {

          console.log("Houve um erro ao tentar realizar o login!");

          resposta.text().then(texto => {
            console.error(texto);
          });
        }

      }).catch(function (erro) {
        console.log(erro);
      })
    }

    return false;
  }



</script>